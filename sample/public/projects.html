<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>All Projects - South Cotabato Data Bank</title>
  <link rel="stylesheet" href="../assets/css/variables.css">
  <link rel="stylesheet" href="../assets/css/base.css">
  <link rel="stylesheet" href="../assets/css/components.css">
  <link rel="stylesheet" href="../assets/css/utilities.css">
  <link rel="stylesheet" href="../assets/css/public.css">
</head>
<body>
  <header class="public-header">
    <div class="public-header-content">
      <a href="index.html" class="public-logo"><i data-lucide="database"></i><span>SC Data Bank</span></a>
      <nav class="public-nav">
        <a href="index.html" class="public-nav-link"><i data-lucide="home"></i><span>Home</span></a>
        <a href="map.html" class="public-nav-link"><i data-lucide="map"></i><span>Map View</span></a>
        <a href="projects.html" class="public-nav-link active"><i data-lucide="folder"></i><span>Projects</span></a>
        <a href="analytics.html" class="public-nav-link"><i data-lucide="bar-chart"></i><span>Analytics</span></a>
      </nav>
    </div>
  </header>

  <section class="section">
    <div class="section-content">
      <div class="section-header">
        <h1 class="section-title">All Projects</h1>
        <p class="section-description">Browse and filter CATCH-UP projects across South Cotabato</p>
      </div>

      <!-- Filters -->
      <div class="project-filters">
        <div class="project-filters-header">
          <h3 class="project-filters-title">Filters</h3>
          <button class="btn btn-ghost btn-sm" onclick="resetFilters()"><i data-lucide="x"></i><span>Clear</span></button>
        </div>
        <div class="project-filters-grid">
          <div>
            <label class="form-label">Search</label>
            <input type="text" id="searchInput" class="form-input" placeholder="Search projects..." onkeyup="filterProjects()">
          </div>
          <div>
            <label class="form-label">Category</label>
            <select id="categoryFilter" class="form-select" onchange="filterProjects()">
              <option value="">All Categories</option>
            </select>
          </div>
          <div>
            <label class="form-label">Status</label>
            <select id="statusFilter" class="form-select" onchange="filterProjects()">
              <option value="">All Status</option>
              <option value="planning">Planning</option>
              <option value="in_progress">In Progress</option>
              <option value="completed">Completed</option>
            </select>
          </div>
          <div>
            <label class="form-label">Municipality</label>
            <select id="municipalityFilter" class="form-select" onchange="filterProjects()">
              <option value="">All Municipalities</option>
            </select>
          </div>
        </div>
      </div>

      <!-- View Toggle -->
      <div style="display: flex; justify-content: space-between; align-items: center; margin: 2rem 0 1rem;">
        <p style="font-size: var(--text-sm); color: hsl(var(--muted-foreground));">
          Showing <span id="projectCount">0</span> projects
        </p>
        <div class="view-toggle">
          <button class="view-toggle-btn active" onclick="setView('grid')"><i data-lucide="grid"></i><span>Grid</span></button>
          <button class="view-toggle-btn" onclick="setView('list')"><i data-lucide="list"></i><span>List</span></button>
        </div>
      </div>

      <!-- Projects Grid -->
      <div id="projectsContainer" class="project-grid"></div>

      <!-- Pagination -->
      <div id="pagination" style="margin-top: 2rem; display: flex; justify-content: center;"></div>
    </div>
  </section>

  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="../assets/js/icons.js"></script>
  <script src="../assets/js/main.js"></script>
  <script src="../assets/js/mock-data.js"></script>
  <script>
    let currentPage = 1;
    const itemsPerPage = 9;
    let filteredProjects = [];
    let currentView = 'grid';

    document.addEventListener('DOMContentLoaded', function() {
      loadFilters();
      filterProjects();
    });

    function loadFilters() {
      // Categories
      const categories = [...new Set(window.mockData.projects.map(p => p.category))];
      const categorySelect = document.getElementById('categoryFilter');
      categories.forEach(cat => {
        const option = document.createElement('option');
        option.value = cat;
        option.textContent = cat;
        categorySelect.appendChild(option);
      });

      // Municipalities
      const municipalities = [...new Set(window.mockData.projects.map(p => p.municipality))];
      const municipalitySelect = document.getElementById('municipalityFilter');
      municipalities.forEach(mun => {
        const option = document.createElement('option');
        option.value = mun;
        option.textContent = mun;
        municipalitySelect.appendChild(option);
      });
    }

    function filterProjects() {
      const search = document.getElementById('searchInput').value.toLowerCase();
      const category = document.getElementById('categoryFilter').value;
      const status = document.getElementById('statusFilter').value;
      const municipality = document.getElementById('municipalityFilter').value;

      filteredProjects = window.mockData.projects.filter(project => {
        const matchesSearch = !search || project.title.toLowerCase().includes(search) || project.description.toLowerCase().includes(search);
        const matchesCategory = !category || project.category === category;
        const matchesStatus = !status || project.status === status;
        const matchesMunicipality = !municipality || project.municipality === municipality;
        return matchesSearch && matchesCategory && matchesStatus && matchesMunicipality;
      });

      currentPage = 1;
      renderProjects();
    }

    function renderProjects() {
      const start = (currentPage - 1) * itemsPerPage;
      const paginatedProjects = filteredProjects.slice(start, start + itemsPerPage);

      const container = document.getElementById('projectsContainer');
      container.innerHTML = paginatedProjects.map(project => `
        <div class="project-card" onclick="window.location.href='project-detail.html?id=${project.id}'">
          <div class="project-card-image"><i data-lucide="image" style="width: 3rem; height: 3rem;"></i></div>
          <div class="project-card-content">
            <div class="project-card-header">
              <h3 class="project-card-title">${truncateText(project.title, 60)}</h3>
              <span class="badge ${getStatusBadgeClass(project.status)}">${getStatusLabel(project.status)}</span>
            </div>
            <div class="project-card-meta">
              <div class="project-card-meta-item"><i data-lucide="map-pin"></i><span>${project.sitio_name}</span></div>
              <div class="project-card-meta-item"><i data-lucide="tag"></i><span>${project.category}</span></div>
            </div>
            <p class="project-card-description">${truncateText(project.description, 100)}</p>
            <div class="project-card-footer">
              <div style="display: flex; align-items: center; gap: 0.5rem;">
                <i data-lucide="users" style="width: 1rem; height: 1rem;"></i>
                <span style="font-size: var(--text-sm);">${formatNumber(project.beneficiaries)}</span>
              </div>
              <div style="font-weight: 500; color: hsl(var(--primary));">${project.completion_percentage}%</div>
            </div>
          </div>
        </div>
      `).join('');

      document.getElementById('projectCount').textContent = filteredProjects.length;

      // Pagination
      const paginationContainer = document.getElementById('pagination');
      paginationContainer.innerHTML = '';
      if (filteredProjects.length > itemsPerPage) {
        paginationContainer.appendChild(createPagination(filteredProjects.length, itemsPerPage, currentPage, (page) => {
          currentPage = page;
          renderProjects();
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }));
      }

      refreshIcons();
    }

    function setView(view) {
      currentView = view;
      document.querySelectorAll('.view-toggle-btn').forEach(btn => btn.classList.remove('active'));
      event.target.closest('.view-toggle-btn').classList.add('active');
      // Grid/list view implementation
      const container = document.getElementById('projectsContainer');
      if (view === 'list') {
        container.style.gridTemplateColumns = '1fr';
      } else {
        container.style.gridTemplateColumns = '';
      }
    }

    function resetFilters() {
      document.getElementById('searchInput').value = '';
      document.getElementById('categoryFilter').value = '';
      document.getElementById('statusFilter').value = '';
      document.getElementById('municipalityFilter').value = '';
      filterProjects();
    }
  </script>
</body>
</html>
