<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sitio Details - South Cotabato Data Bank</title>
  <link rel="stylesheet" href="../assets/css/variables.css">
  <link rel="stylesheet" href="../assets/css/base.css">
  <link rel="stylesheet" href="../assets/css/components.css">
  <link rel="stylesheet" href="../assets/css/utilities.css">
  <link rel="stylesheet" href="../assets/css/public.css">
</head>
<body>
  <header class="public-header">
    <div class="public-header-content">
      <a href="index.html" class="public-logo"><i data-lucide="database"></i><span>SC Data Bank</span></a>
      <nav class="public-nav">
        <a href="index.html" class="public-nav-link"><i data-lucide="home"></i><span>Home</span></a>
        <a href="map.html" class="public-nav-link active"><i data-lucide="map"></i><span>Map View</span></a>
        <a href="projects.html" class="public-nav-link"><i data-lucide="folder"></i><span>Projects</span></a>
        <a href="analytics.html" class="public-nav-link"><i data-lucide="bar-chart"></i><span>Analytics</span></a>
      </nav>
    </div>
  </header>

  <div class="detail-header">
    <div class="detail-header-content">
      <div class="breadcrumb" style="color: rgba(255,255,255,0.9); margin-bottom: 1rem;">
        <a href="map.html" style="color: rgba(255,255,255,0.9);">Map</a>
        <span class="breadcrumb-separator">/</span>
        <span>Sitio Details</span>
      </div>
      <h1 class="detail-title" id="sitioName"></h1>
      <div class="detail-meta">
        <div class="detail-meta-item"><i data-lucide="map"></i><span id="sitioBarangay"></span></div>
        <div class="detail-meta-item"><i data-lucide="map-pin"></i><span id="sitioMunicipality"></span></div>
        <div class="detail-meta-item"><i data-lucide="users"></i><span id="sitioPopulation"></span></div>
        <div class="detail-meta-item"><i data-lucide="home"></i><span id="sitioHouseholds"></span></div>
      </div>
    </div>
  </div>

  <div class="detail-content">
    <div class="detail-grid">
      <div class="detail-main">
        <!-- Demographics -->
        <div class="card">
          <div class="card-header"><h3 class="card-title">Demographic Profile</h3></div>
          <div class="card-content">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
              <div>
                <div style="font-size: var(--text-xs); color: hsl(var(--muted-foreground)); margin-bottom: 0.5rem;">Employment Rate</div>
                <div style="display: flex; align-items: center; gap: 1rem;">
                  <div style="font-size: var(--text-2xl); font-weight: var(--font-bold); color: hsl(var(--primary));" id="employmentRate">0%</div>
                  <div style="flex: 1; height: 0.5rem; background: hsl(var(--muted)); border-radius: 999px; overflow: hidden;">
                    <div id="employmentBar" style="height: 100%; background: hsl(var(--primary)); transition: width 0.3s;"></div>
                  </div>
                </div>
              </div>
              <div>
                <div style="font-size: var(--text-xs); color: hsl(var(--muted-foreground)); margin-bottom: 0.5rem;">Poverty Incidence</div>
                <div style="display: flex; align-items: center; gap: 1rem;">
                  <div style="font-size: var(--text-2xl); font-weight: var(--font-bold); color: hsl(var(--destructive));" id="povertyRate">0%</div>
                  <div style="flex: 1; height: 0.5rem; background: hsl(var(--muted)); border-radius: 999px; overflow: hidden;">
                    <div id="povertyBar" style="height: 100%; background: hsl(var(--destructive)); transition: width 0.3s;"></div>
                  </div>
                </div>
              </div>
              <div>
                <div style="font-size: var(--text-xs); color: hsl(var(--muted-foreground)); margin-bottom: 0.5rem;">Farmers</div>
                <div style="display: flex; align-items: center; gap: 1rem;">
                  <div style="font-size: var(--text-2xl); font-weight: var(--font-bold); color: hsl(var(--accent));" id="farmersRate">0%</div>
                  <div style="flex: 1; height: 0.5rem; background: hsl(var(--muted)); border-radius: 999px; overflow: hidden;">
                    <div id="farmersBar" style="height: 100%; background: hsl(var(--accent)); transition: width 0.3s;"></div>
                  </div>
                </div>
              </div>
              <div>
                <div style="font-size: var(--text-xs); color: hsl(var(--muted-foreground)); margin-bottom: 0.5rem;">Potable Water Access</div>
                <div style="display: flex; align-items: center; gap: 1rem;">
                  <div style="font-size: var(--text-2xl); font-weight: var(--font-bold); color: hsl(var(--primary));" id="waterAccess">0%</div>
                  <div style="flex: 1; height: 0.5rem; background: hsl(var(--muted)); border-radius: 999px; overflow: hidden;">
                    <div id="waterBar" style="height: 100%; background: hsl(var(--primary)); transition: width 0.3s;"></div>
                  </div>
                </div>
              </div>
              <div>
                <div style="font-size: var(--text-xs); color: hsl(var(--muted-foreground)); margin-bottom: 0.5rem;">Electricity Access</div>
                <div style="display: flex; align-items: center; gap: 1rem;">
                  <div style="font-size: var(--text-2xl); font-weight: var(--font-bold); color: hsl(var(--accent));" id="electricityAccess">0%</div>
                  <div style="flex: 1; height: 0.5rem; background: hsl(var(--muted)); border-radius: 999px; overflow: hidden;">
                    <div id="electricityBar" style="height: 100%; background: hsl(var(--accent)); transition: width 0.3s;"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Projects in this Sitio -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Projects in this Sitio</h3>
            <span class="badge badge-primary" id="projectCount">0</span>
          </div>
          <div class="card-content">
            <div id="projectsList"></div>
          </div>
        </div>
      </div>

      <div class="detail-sidebar">
        <!-- Quick Stats -->
        <div class="card">
          <div class="card-header"><h3 class="card-title">Quick Stats</h3></div>
          <div class="card-content">
            <div style="display: flex; flex-direction: column; gap: 1.5rem;">
              <div style="text-align: center;">
                <i data-lucide="users" style="width: 2.5rem; height: 2.5rem; margin: 0 auto 0.5rem; color: hsl(var(--primary));"></i>
                <div style="font-size: var(--text-2xl); font-weight: var(--font-bold);" id="populationStat">0</div>
                <div style="font-size: var(--text-sm); color: hsl(var(--muted-foreground));">Total Population</div>
              </div>
              <div style="text-align: center;">
                <i data-lucide="home" style="width: 2.5rem; height: 2.5rem; margin: 0 auto 0.5rem; color: hsl(var(--primary));"></i>
                <div style="font-size: var(--text-2xl); font-weight: var(--font-bold);" id="householdsStat">0</div>
                <div style="font-size: var(--text-sm); color: hsl(var(--muted-foreground));">Households</div>
              </div>
              <div style="text-align: center;">
                <i data-lucide="folder" style="width: 2.5rem; height: 2.5rem; margin: 0 auto 0.5rem; color: hsl(var(--primary));"></i>
                <div style="font-size: var(--text-2xl); font-weight: var(--font-bold);" id="projectsStat">0</div>
                <div style="font-size: var(--text-sm); color: hsl(var(--muted-foreground));">Active Projects</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Actions -->
        <div class="card">
          <div class="card-header"><h3 class="card-title">Actions</h3></div>
          <div class="card-content">
            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
              <button class="btn btn-outline w-full" onclick="window.location.href='map.html'">
                <i data-lucide="map"></i>
                <span>View on Map</span>
              </button>
              <button class="btn btn-outline w-full" onclick="window.location.href='projects.html'">
                <i data-lucide="folder"></i>
                <span>View All Projects</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/lucide@latest"></script>
  <script src="../assets/js/icons.js"></script>
  <script src="../assets/js/main.js"></script>
  <script src="../assets/js/mock-data.js"></script>
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const sitioId = urlParams.get('id');
    let currentSitio;

    document.addEventListener('DOMContentLoaded', function() {
      if (!sitioId) {
        window.location.href = 'map.html';
        return;
      }
      loadSitioDetails();
    });

    function loadSitioDetails() {
      currentSitio = window.mockData.getSitioById(sitioId);
      if (!currentSitio) {
        alert('Sitio not found');
        window.location.href = 'map.html';
        return;
      }

      // Header info
      document.getElementById('sitioName').textContent = currentSitio.name;
      document.getElementById('sitioBarangay').textContent = 'Barangay ' + currentSitio.barangay;
      document.getElementById('sitioMunicipality').textContent = currentSitio.municipality;
      document.getElementById('sitioPopulation').textContent = formatNumber(currentSitio.population) + ' residents';
      document.getElementById('sitioHouseholds').textContent = formatNumber(currentSitio.households) + ' households';

      // Demographics
      const demo = currentSitio.demographics;
      document.getElementById('employmentRate').textContent = demo.employment_rate + '%';
      document.getElementById('employmentBar').style.width = demo.employment_rate + '%';
      document.getElementById('povertyRate').textContent = demo.poverty_incidence + '%';
      document.getElementById('povertyBar').style.width = demo.poverty_incidence + '%';
      document.getElementById('farmersRate').textContent = demo.farmers + '%';
      document.getElementById('farmersBar').style.width = demo.farmers + '%';
      document.getElementById('waterAccess').textContent = demo.potable_water_access + '%';
      document.getElementById('waterBar').style.width = demo.potable_water_access + '%';
      document.getElementById('electricityAccess').textContent = demo.electricity_access + '%';
      document.getElementById('electricityBar').style.width = demo.electricity_access + '%';

      // Sidebar stats
      document.getElementById('populationStat').textContent = formatNumber(currentSitio.population);
      document.getElementById('householdsStat').textContent = formatNumber(currentSitio.households);
      document.getElementById('projectsStat').textContent = currentSitio.projects_count;

      // Load projects
      loadProjects();
      refreshIcons();
    }

    function loadProjects() {
      const projects = window.mockData.getProjectsBySitio(sitioId);
      document.getElementById('projectCount').textContent = projects.length;

      const container = document.getElementById('projectsList');
      if (projects.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: hsl(var(--muted-foreground)); padding: 2rem;">No projects in this sitio yet.</p>';
        return;
      }

      container.innerHTML = projects.map(project => `
        <div onclick="window.location.href='project-detail.html?id=${project.id}'" style="padding: 1rem; border: 1px solid hsl(var(--border)); border-radius: var(--radius); margin-bottom: 0.75rem; cursor: pointer; transition: all 0.2s;">
          <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
            <div style="font-weight: 500;">${truncateText(project.title, 60)}</div>
            <span class="badge ${getStatusBadgeClass(project.status)}">${getStatusLabel(project.status)}</span>
          </div>
          <div style="font-size: var(--text-sm); color: hsl(var(--muted-foreground)); margin-bottom: 0.5rem;">${project.category}</div>
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <span style="font-size: var(--text-sm); color: hsl(var(--muted-foreground));">â‚±${formatNumber(project.budget)}</span>
            <span style="font-size: var(--text-sm); font-weight: 500; color: hsl(var(--primary));">${project.completion_percentage}% complete</span>
          </div>
        </div>
      `).join('');
    }
  </script>
</body>
</html>
